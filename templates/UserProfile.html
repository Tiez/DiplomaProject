{% extends "base.html" %}


{% block style %}

{% endblock %}

{% block content %}
User Profile

<style>
    #contribution-grid {
        display: flex;
        flex-direction: row;
    }

    .month {
        padding: 10px;
        margin-bottom: 40px;
    }

    .month-name {
        font-weight: bold;
        margin-bottom: 5px;
    }

    .grid {
        display: grid;
        grid-auto-flow: column;
        /* each week is a column */
        grid-template-rows: repeat(7, 15px);
        /* 7 days per week */
        gap: 3px;
    }

    .empty {
        width: 15px;
        height: 15px;
    }

    .day {
        width: 15px;
        height: 15px;
        border-radius: 3px;
        background-color: #313131;
        /* gray for zero */
    }

    .level-1 {
        background-color: #1a391f;
    }

    .level-2 {
        background-color: #25532f;
    }

    .level-3 {
        background-color: #388a47;
    }

    .level-4 {
        background-color: #41cd5a;
    }
</style>
</head>

<body>

    <div id="contribution-grid"></div>

    <script type="module">
        let contriData;

        const response = await fetch('/contributions');
        if (!response.ok) throw new Error('Network response was not ok');

        const data = await response.json(); // parse JSON
        contriData = data

        // Now you can use this data to render your grid
        // Example: pass it to your renderGrid function


        let emptyData = {}
        const year = new Date().getFullYear();
        for (let m = 0; m < 12; m++) {
            const daysInMonth = new Date(year, m + 1, 0).getDate();
            emptyData[m] = [];
            for (let d = 1; d <= daysInMonth; d++) {
                emptyData[m].push(0);
            }
        }


        // let contributions = generateRandomContributions();

        const months = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        let contributions = seedContributions(emptyData);



        function calculateDaysForMonth(month) {

            const monthDay = month % 2 === 0;

            if (month === 1) {
                return 27;
            }
            if (month >= 7) {
                if (monthDay) {
                    return 29;
                } else {
                    return 30;
                }
            } else {
                if (monthDay) {
                    return 30;
                } else {
                    return 29;
                }
            }
        }

        function seedContributions(contributionData) {
            months.forEach((monthName, monthIndex) => {
                console.log(monthName + " " + contriData[String(monthIndex)])
                let eachMonthContributions = contriData[String(monthIndex)]

                if (eachMonthContributions) {
                    eachMonthContributions.forEach((dayContri, index) => {


                        if (dayContri) {
                            console.log(contributionData)
                            console.log(contributionData[monthIndex], monthName)
                            console.log(dayContri["dateData"][0], dayContri["dateData"][1])



                            contributionData[monthIndex][dayContri["dateData"][0] - 1] = dayContri["dateData"][1];
                        }

                    })
                }
            })
            return contributionData;
        }



        // Generate random contributions
        function generateRandomContributions() {
            let data = {};
            const year = new Date().getFullYear();
            for (let m = 0; m < 12; m++) {
                const daysInMonth = new Date(year, m + 1, 0).getDate();
                data[m] = [];
                for (let d = 1; d <= daysInMonth; d++) {
                    data[m].push(Math.floor(Math.random() * 12));
                }
            }
            return data;
        }

        function getContributionLevel(count) {
            if (count <= 0) return 0;
            if (count <= 2) return 1;
            if (count <= 4) return 2;
            if (count <= 6) return 3;
            return 4;
        }

        const container = document.getElementById("contribution-grid");

        // console.log(contriData["10"].length);
        // contriData.forEach((monthName, monthIndex) => {
        //     console.log(contributions[0]);
        // });








        months.forEach((monthName, monthIndex) => {

            const monthDiv = document.createElement("div");
            monthDiv.className = "month";

            const monthLabel = document.createElement("div");
            monthLabel.className = "month-name";
            monthLabel.textContent = monthName;
            monthDiv.appendChild(monthLabel);

            const grid = document.createElement("div");
            grid.className = "grid";

            const days = contributions[monthIndex];
            // console.log(days)

            const firstDay = new Date(new Date().getFullYear(), monthIndex, 1).getDay(); // 0=Sunday
            const totalWeeks = Math.ceil((firstDay + days.length) / 7);

            for (let w = 0; w < totalWeeks; w++) {

                for (let d = 0; d < 7; d++) {
                    const dayIndex = w * 7 + d - firstDay;

                    const dayDiv = document.createElement("div");
                    dayDiv.className = "day";


                    if (dayIndex >= 0 && dayIndex < days.length) {

                        const level = getContributionLevel(days[dayIndex]);
                        if (level) dayDiv.classList.add(`level-${level}`);
                    }

                    if (dayIndex >= 0 && dayIndex <= calculateDaysForMonth(monthIndex)) {
                        grid.appendChild(dayDiv);

                    } else {
                        // console.log(calculateDaysForMonth(monthIndex))
                        const emptyDay = document.createElement("div");
                        emptyDay.className = "empty"
                        grid.appendChild(emptyDay);
                    }
                }
            }

            monthDiv.appendChild(grid);
            container.appendChild(monthDiv);
        });
    </script>

    {% endblock %}